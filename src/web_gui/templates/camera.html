<!-- 
  - @author Bilal Yousufzai [biy1]   
  - @version 0.1 initial creation
  - @version
  - @version
  - @version
  - @version
  - @version
  - @version Added settings button with cog icon and content.
  - @version Added link link option to traethlin.html.
  - @version Added sound files.
  - @version Added 'toggle-container' and 'sound-toggle'.
  - @version Added 'Clear' button for log clearance.
 -->
 <!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Robot Control Web GUI</title>
     <!-- Link to CSS file -->
     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
     <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
     <script src="{{ url_for('static', filename='traethlin/libraries/eventemitter2.min.js') }}"></script>
     <script src="{{ url_for('static', filename='traethlin/libraries/easeljs.min.js') }}"></script>
     <script src="{{ url_for('static', filename='traethlin/libraries/roslib.min.js') }}"></script>
     <link rel="stylesheet" href="{{ url_for('static', filename='/cam.css') }}">
     <link rel="stylesheet" href="{{ url_for('static', filename='/css/settings.css') }}">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
 </head>
 <body>
     <div id="gui-container">
        <div class="tab-container">
            <button class="tab" data-page="trailTracer" onclick="openPage('trailTracer')">Trail Tracer</button>
            <button class="tab" data-page="traethlin" onclick="openPage('traethlin')">Treathlin</button>
        </div>
         <header>
             <div class="header-container">
                 <!-- <a href="/camera" class="button-like-link">Go to Record Page</a> -->
                 <h1>Trail Tracer Web GUI</h1>
                 <button id="settings-button"><i class="fas fa-cog"></i></button>
                 <!-- Settings popup menu -->
                 <div id="settings-menu" class="settings-popup" style="display: none;">
                     <ul class="settings-list">
                         <li><a href="/user_guide">User Guide For Trail Trace</a></li>
                         <li class="has-submenu"><a href="/#">Supported Sites</a>
                             <ul class="submenu">
                                 <li><a href="/traethlin">Traethlin</a></li>
                                 <li><a href="/camera">Cam</a></li>
                                 <!-- More sites here for future additions-->
                             </ul>
                         </li>
                     </ul>
                 </div>                
             </div>
             <!-- Toggle Button to switch between modes -->
             <div class="toggle-container">
                 <button class="toggle" id="mode-toggle">Switch to Manual Navigation</button>
                 <button class="toggle" id="sound-toggle">Sound Off</button>
             </div>
         </header>
         <section id="trailTracer" class="tabcontent">
            <section id="map-section">
                <div id="map"></div>
                <div id="map-controls">
                    <button id="locate-me-button">Locate Me</button>
                </div>
            </section>
            <!-- Automatic Navigation  -->
            <section id="dashboard-controls">
                <article id="data-dashboard">
                    <h2>Telemetry Data</h2>
                    <p>Latitude: <span id="latitude">N/A</span></p>
                    <p>Longitude: <span id="longitude">N/A</span></p>
                    <p>Linear Speed: <span id="linearSpeed">0.0 m/s</span></p>
                    <p>Angular Speed: <span id="angularSpeed">0.0 rad/s</span></p>                
                </article>
                <aside id="control-panel">
                    <h2>Control Panel</h2>
                    <button id="plot-trail-button">Plot Trail</button>
                    <button id="pause-button" style="display: none;">Pause</button>
                    <button id="load-trail-button">Load Trail</button>
                    <span id="emergency-msg" style="color: red; align-items:center; padding-left: 60px; display: none;">HIT SPACE FOR EMERGENCY STOP!</span>
                </aside>
            </section>
            <!-- Manual Navigation for Path Tracking -->
            <section id="manual-controls" style="display: none;"> <!-- Initially hidden -->
                <article id="manual-data-dashboard"> 
                    <h2>Telemetry Data</h2>
                    <p>Latitude: <span id="manual-latitude">N/A</span></p>
                    <p>Longitude: <span id="manual-longitude">N/A</span></p>
                    <p>Linear Speed: <span id="manual-linearSpeed">0.0 m/s</span></p>
                    <p>Angular Speed: <span id="manual-angularSpeed">0.0 rad/s</span></p>                
                </article>
                <aside id="manual-control-panel">
                    <h2>Control Panel</h2>
                    <button id="manual-start">Record Trail</button>
                    <button id="manual-move">Manualy Move Robot</button>
                    <div id="joystick-container">
                        <div id="joystick"></div> <!-- Placeholder for the joystick -->
                    </div>
                </aside>
            </section>
            <!-- System Log -->
            <footer id="system-log">
                <div class="log-header">
                    <h2>System Log</h2>
                    <button id="clear-log">Clear Log</button>
                </div>
                <textarea id="log-window" readonly></textarea>
            </footer>
         </section>
         <section id="traethlin" class="tabcontent">
            <div class="row">
                <div id="connectionOptions" class="column">
                  <div class="block-display">
                    <button id="startstop" class="button">Connect to system</button>
                    <button id="shutdown" class="button">Shutdown the system</button>
                    <!--<button id="reboot" class="button">Reboot the system</button> -->
                  </div>
                </div>
                <div id="gearControl" class="column">
                  <div class="block-display">
                    <div>
                      High gear:
                      <label class="switch">
                        <input id="high_low_gear" type="checkbox">
                        <span class="slider round"></span>
                      </label>
                    </div>
                    <div>
                      Front diff locked:
                      <label class="switch">
                        <input id="front_diff" type="checkbox">
                        <span class="slider round"></span>
                      </label>
                    </div>
                    <div>
                      Rear diff locked:
                      <label class="switch">
                        <input id="rear_diff" type="checkbox">
                        <span class="slider round"></span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              <div id="manualControl" class="justify">
                <h2>Manual joystick control</h2>
                <div id="joystick_wrapper">
                  <div id="traethlin-joystick">
                  </div>
                </div>
              </div>            
         </section>
     </div>


     <!-- Prompt for Trail Selection -->
     <div id="trail-prompt" style="display: none;"> <!-- Initially hidden -->
         <div id="prompt-header">
             <h2>Select Trail</h2>
             <button id="exit-prompt" style="float: right;">Exit</button>
         </div>
         <div id="prompt-body">
             <select id="trail-dropdown">
             </select>
             <button id="start-trail">Start</button>
         </div>
     </div>
     <!-- Prompt for Name Selection -->
     <div id="trail-name-prompt" style="display: none;"> <!-- Initially hidden -->
         <div id="prompt-header">
             <h2>Name Trail</h2>
             <span id="no-entry-error" style="color: red; display: none;">No Trail Name Entered!</span>
             <span id="file-exists-error" style="color: red; display: none;">Trail Name Exists! Coose New File Name</span>
             <button id="exit-name-prompt">Exit</button>
         </div>
         <div id="prompt-body">
             <input type="text" id="trailNameInput" placeholder="Trail Name">
             <button id="saveTrailName">Save Trail Name</button>
         </div>
     </div>
     <!-- Prompt for Name Selection -->
     <div id="plot-name-prompt" style="display: none;"> <!-- Initially hidden -->
         <div id="prompt-header">
             <h2>Name Trail</h2>
             <span id="entry-error" style="color: red; display: none;">No Trail Name Entered!</span>
             <span id="file-exist" style="color: red; display: none;">Trail Name Exists! Coose New File Name</span>
             <button id="exit-plot-name-prompt">Exit</button>
         </div>
         <div id="prompt-body">
             <input type="text" id="plotNameInput" placeholder="Trail Name">
             <button id="savePlotName">Save Trail Name</button>
         </div>
     </div>
     
     <!-- sound element is downlaoded from https://mixkit.co/free-sound-effects -->
     <audio id="click" src="{{ url_for('static', filename='util/audio_files/click.mp3')}}" type="audio/mpeg"></audio>
     <audio id="toggle_sound" src="{{ url_for('static', filename='util/audio_files/toggle.mp3')}}" type="audio/mpeg"></audio>
     <audio id="check_sound" src="{{ url_for('static', filename='util/audio_files/check.mp3')}}" type="audio/mpeg"></audio>
 
 
     <!-- Link to JavaScript files -->
     <script>
     function openPage(pageName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tab");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(pageName).style.display = "block";
        document.querySelector("[data-page='" + pageName + "']").className += " active";

        var header = document.querySelector('header');
        if(pageName === 'traethlin'){
            header.style.display = 'none';
        } else{
            header.style.display = 'block';
        }
    }


        // Initial tab setup
    document.addEventListener('DOMContentLoaded', function() {
        openPage('trailTracer'); // Default page
    });
     </script>
     <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
     <script src="https://unpkg.com/leaflet-routing-machine"></script>
     <!-- <script src="https://cdn.jsdelivr.net/npm/roslib"></script> -->
     <script src="{{ url_for('static', filename='camera.js') }}"></script>
     <script src="{{ url_for('static', filename='/js/gui_script.js') }}"></script>
     <script src="{{ url_for('static', filename='/js/map_ui.js') }}"></script>
     <script src="{{ url_for('static', filename='/js/dashboard_event_listeners.js') }}"></script>
     <script src="{{ url_for('static', filename='/js/settings.js') }}"></script>
     <script src="{{ url_for('static', filename='/js/prompt_event_listners.js') }}"></script>
     <!-- Include nipplejs for the joystick -->
     <script src="https://cdn.jsdelivr.net/npm/nipplejs"></script>
 </body>
 </html>
 